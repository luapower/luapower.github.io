<!DOCTYPE html>
<html>
	<head>
		<meta charset='utf-8'>
		<title> get involved   - I want YOU for LUA POWER </title>
		<script src="jquery.js"></script>
		<script src="jquery-cookie.js"></script>
		<script src="jquery-tablesorter.js"></script>
		<script src="strftime.js"></script>
		<script src="config.js"></script>
		<script src="main.js"></script>
		<link rel="stylesheet" type="text/css" href="templates/reset.css" />
		<link rel="stylesheet" type="text/css" href="templates/hack.css" />
		<link rel="stylesheet" type="text/css" id="lights_css" />
		<script>
			var DOCNAME = 'get-involved'
			var PROJECT = ''
			//set the lights before rendering starts
			set_lights()
		</script>
	</head>
	<body>
		<header>
			<div class="container">
				<div class="btn-container btn-lights-container">
					<a href="#" class="btn btn-lights" id="lights">lights</a>
				</div>
				
				<div class="btn-container btn-home-container">
					<a href="/" class="btn btn-home">luapower</a>
				</div>
				
				<table id="header_table">
					<tr>
						<td style="vertical-align: middle;" width="100%">
							<h1> get involved </h1>
							<h2> I want YOU for LUA POWER </h2>
						</td>
						<td style="vertical-align: middle;" align="right" style="height: 150px">
																											</td>
					</tr>
				</table>
															</div>
		</header>
		<div class="bg-container">
			<div class="bg-center-container">
									<div class="bg bg-get-involved" style="background-image: url('bg/get-involved.png');"></div>
							</div>
		</div>
		<div class="under-header">
			<div class="container">
				<div id="toc_container" class="toc_container doc"></div>
				<section class="doc">
					<span id="module_info"></span>
					<blockquote>
<p>NOTE: This page is all about rules, so necessarily you will have issues with it. But whether or not you agree with the decisions taken, please recognize that <em>some</em> decisions had to be taken, and <em>some</em> conventions had to be created, in order to achieve specific benefits, and that's the only reason for creating these conventions. I fully recognize and respect the fact everybody has his/hers own rules and work flow and coding style, which can only accidentally coincide with mine, and I'd rather support individual freedom than enforce popular convention. Please have this in mind when reading upon these rules, and remember that they are open for evaluation and improvement. As always, feedback is welcome and appreciated.</p>
</blockquote>
<h2 id="anatomy-of-a-package">Anatomy of a package</h2>
<p>There are 5 types of luapower packages:</p>
<ul>
<li><strong>Lua module</strong>: written in Lua, compatible with LuaJIT2, Lua 5.1 and optionally Lua 5.2</li>
<li><strong>Lua/C module</strong>: written in C using the Lua C API, compatible with LuaJIT2, Lua 5.1 and optionally Lua 5.2</li>
<li><strong>Lua+ffi module</strong>: written in Lua using the LuaJIT ffi extension, compatible with LuaJIT2 and optionally with Lua ffi; the C library it binds to is included in the package in source and binary form</li>
<li><strong>C module</strong>: binary dependency or support library for other module; source and binary included</li>
<li><strong>other</strong>: none of the above: media/support files, etc.</li>
</ul>
<h3 id="the-layout">The Layout</h3>
<ul>
<li>main module: <code>foo.lua</code></li>
<li>submodule: <code>foo_bar.lua</code> but <code>foo/bar.lua</code> is fine too</li>
<li>ffi cdef module: <code>foo_h.lua</code></li>
<li>test program: <code>foo_test.lua</code></li>
<li>demo: <code>foo_demo.lua</code></li>
<li>documentation: <code>foo.md</code>, <code>foo_bar.md</code> (pandoc markdown)</li>
<li>C libs &amp; Lua/C libs:
<ul>
<li>sources: <code>csrc/foo/*</code></li>
<li>build scripts: <code>csrc/foo/build-&lt;platform&gt;.sh</code>
<ul>
<li>platforms are named mingw32, mingw64, linux32, linux64, osx32, osx64, android.</li>
</ul></li>
<li>binaries (resulted from building):
<ul>
<li>C libraries: <code>bin/mingw32/foo.dll</code>, <code>bin/linux32/libfoo.so</code></li>
<li>Lua/C libraries: <code>bin/&lt;platform&gt;/clib/foo[.dll|.so]</code></li>
</ul></li>
<li>description: <code>csrc/foo/WHAT</code> (see below)</li>
</ul></li>
<li>exclude file: <code>foo.exclude</code> (see below)</li>
<li>LuaJIT executable: <code>bin/&lt;platform&gt;/luajit[.exe]</code></li>
</ul>
<blockquote>
<p>These conventions allow packages to be safely unzipped over a common directory and the result look sane, and it makes it possible to extract package information and build the package database.</p>
</blockquote>
<h3 id="the-docs">The Docs</h3>
<p>Docs should start with a yaml header:</p>
<pre><code>---
project: spheroboom
tagline: defeats scammers
---</code></pre>
<ul>
<li>the <code>project</code> field should match the git project's name (if you want the github buttons to appear).</li>
<li><code>platforms: platform1, ...</code> should be added for Lua packages that are platform-specific but don't have a C component (eg. <a href="winapi.html">winapi</a>; for packages with a C component, adding the build scripts is enough to figure out the supported platforms).</li>
<li>a good, short tagline is important for figuring out what the module does when browsing the module list</li>
</ul>
<p>You don't have to make a doc for each submodule if you don't have much to document for it.</p>
<h3 id="the-what-file">The <code>WHAT</code> file</h3>
<p>The WHAT file is used for packages that have a C component (Lua+ffi, Lua/C or C packages), and it's used to describe that C component.</p>
<ul>
<li>the first line should read <code>&lt;name&gt; &lt;version&gt; from &lt;browse-url&gt; (&lt;license&gt;)</code></li>
<li>the second line should read <code>requires: package1, package2, ...</code> and it is only needed if the package has any <em>binary</em> dependencies which are not also Lua dependencies (eg. <a href="cairo.html">cairo</a> needs <a href="pixman.html">pixman</a> this way).</li>
<li>after the first two lines and an empty line, you can type in additional notes, whatever, they aren't parsed.</li>
</ul>
<p>The WHAT file can also be used to describe Lua modules that are developed outside of luapower (eg. <a href="lexer.html">lexer</a>).</p>
<blockquote>
<p>Extracting dependencies from the dll itself and figuring it out from there is a project for another day.</p>
</blockquote>
<h3 id="the-exclude-file">The <code>exclude</code> file</h3>
<p>This is the .gitignore file used for excluding files between packages so that files in one packages don't show as untracked files in other package. Another way to think of it is the file used for reserving name-space in the luapower directory layout.</p>
<p>Example:</p>
<pre><code>*                    ; exclude all files
!/foo*               ; include files in root that start with `foo`
!/foo/               ; include the directory in root named `foo`
!/foo/**             ; include the contents of the directory named `foo`, recursively</code></pre>
<blockquote>
<p>NOTE: Double-asterisk patterns are Git 1.8.2+.</p>
</blockquote>
<h3 id="the-code">The Code</h3>
<ul>
<li>adding at least a small comment on the first line of every Lua file with a short tagline (what the module does), author and license can be a huge barrier-remover towards approaching your code (adding a full-screen of legal crap on the other hand is just bad taste - IMHO).</li>
<li>adding a comment on top of the <code>foo_h.lua</code> file describing the origin (which files? which version???) and process (cpp? by hand?) used for generating the file adds confidence that the C API is complete and updated.</li>
<li>I don't use <code>module()</code>, but if that's what you like, that's fine.</li>
<li>my code is indented with tabs, and alignmenment inside the line is done with spaces, in recognition of the fact that tabsize is a personal preference and it should not be enforced upon people.</li>
<li>I use <code>foo_bar</code> instead of FooBar or fooBar.</li>
<li>use <code>ffi.load()</code> without paths, custom names or version (let the OS find the library: this allows more freedom on how to deploy libraries; the only compatible version is that which you tested the binding against and you included in the package)</li>
<li>the reason for putting cdefs in a separate file is because they could potentially be used separately from the Lua binding or may contain types that other cdef modules need.</li>
<li>it's ok to embed cdefs in the main module for small APIs</li>
</ul>
<h3 id="the-build-scripts">The Build Scripts</h3>
<p>Write a build script for each supported platform. Ideally, your build script is a gcc one-liner like most build scripts around here. Writing gcc one-liners is quite easy for most C libraries. You only have to remember a few important gcc switches:</p>
<ul>
<li><code>-I&lt;dir&gt;</code> : search path for headers</li>
<li><code>-l&lt;libname&gt;</code> : dynamic library dependency (without the <code>lib</code> prefix)</li>
<li><code>-L&lt;dir&gt;</code> : search path for library dependencies</li>
<li><code>-static-libstdc++</code> : static linking of the C++ standard library (so that it doesn't become a runtime dependency)</li>
<li><code>-static-libgcc</code> : static linking of the GCC library (so that it doesn't become a runtime dependency)</li>
<li><code>-O2</code> : enable code optimization</li>
<li><code>-s</code> : strip debug symbols (makes the binary smaller)</li>
<li><code>-D&lt;name&gt;</code> : set a <code>#define</code></li>
<li><code>-D&lt;name&gt;=&lt;value&gt;</code> : set a <code>#define</code></li>
<li><code>-pthread</code> : enable pthread support (Linux only)</li>
<li><code>-fpic</code> : PIC mode (required for 64bit)</li>
</ul>
<h4 id="example-compile-lpeg-for-linux32">Example (compile lpeg for linux32):</h4>
<pre><code>gcc -O2 -s -static-libgcc lpeg.c -shared -o ../../bin/linux32/clib/lpeg.so -I. -I../lua -ansi -DNDEBUG</code></pre>
<p>In some cases it's going to be more complicated than that.</p>
<ul>
<li>sometimes you won't get away with <code>*.c</code> -- some libraries rely on the makefile to choose the C files that need to be compiled for a specific platform or set of options (eg. <a href="socket.html">socket</a>)</li>
<li>some libraries actually use one or two of the myriad of defines generated by the <code>./configure</code> script -- you might have to grep for those and add more <code>-D</code> switches to the command line.</li>
<li>some libraries have parts written in assembler or other language, in which case you will have to do compilation and linking in separate steps. At that point, a (simple) makefile becomes a good alternative.</li>
</ul>
<p>Bigger and more configurable libraries will need more options for sure, and some libraries rely on the build system to make too many decisions. But even large libraries like <a href="cairo.html">cairo</a> can be build with simple shell scripts without compromising on clarity or flexibility.</p>
<h3 id="binaries">Binaries</h3>
<p>Ideally, you would test your build scripts against the standard luapower <a href="building.html">building</a> environments. Spare luapower users for having to add another tool to their toolchain.</p>
<h2 id="publishing">Publishing</h2>
<h3 id="publishing-on-luapower.com">1. Publishing on luapower.com</h3>
<p>The way you add modules to luapower.com is:</p>
<ul>
<li>first you make a git repo that resembles a luapower package</li>
<li>then you can either:
<ul>
<li>publish it under your github account (luapower users will clone from your account directly)
<ul>
<li>ask me to add it to the package database</li>
<li>I'll periodically pull and update the website</li>
</ul></li>
<li>publish it <em>and manage it</em> yourself under the luapower github account (it's an org account)
<ul>
<li>ask me to add you as an admin</li>
<li>you will periodically push and update the website</li>
</ul></li>
</ul></li>
</ul>
<h4 id="what-to-add">What to add</h4>
<p>Before publishing a luapower module, please carefully consider:</p>
<ul>
<li>what name you plan to use for your module</li>
<li>how your module relates to other modules</li>
</ul>
<p>Choosing a good name is important if you want people to find your module on luapower and understand (from the name alone) what it does. Likewise, it's a good idea to be sure that your module is doing something new or at least different (and hopefully better) than something already on luapower.</p>
<p>Ideally, your module has:</p>
<ul>
<li><strong>distinction</strong> - focused problem domain</li>
<li><strong>completeness</strong> - exhaustive of the problem domain</li>
<li><strong>API documentation</strong> - so it can be integrated into luapower.com</li>
<li><strong>test and/or demo</strong> - so it can be seen to work</li>
<li><strong>a non-viral license</strong> - so it doesn't impose restrictions on <em>other</em> modules</li>
</ul>
<blockquote>
<p>It might be that your idea of a good package to add to luapower diverges too much from these criteria, in which case I would politely refuse to add your package to luapower. But here's where you can have your cake and eat it too.</p>
</blockquote>
<h3 id="forking-luapower.com">2. Forking luapower.com</h3>
<p>Luapower can be easily forked and used as a personal website for publishing Lua modules.</p>
<p>Luapower is composed of:</p>
<ul>
<li>a <a href="https://github.com/luapower/luapower.github.io">static website</a> generated with pandoc templating</li>
<li>a <a href="https://github.com/luapower/luapower-git/blob/master/luapower.lua">Lua script</a> for updating the package database, navigation tree, and dependency lists offline</li>
<li>a few <a href="https://github.com/luapower/luapower-git">simple shell scripts</a> for working with git in a shared-work-tree environment</li>
</ul>
<p>Which means that with a few forks and a few tweaks you can have your own luapower clone with your own modules on it. I'll write a section on how to configure a luapower clone if there's interest in the idea.</p>
				</section>
			</div>
			<div class="container">
				<footer>
					<div id="disqus_thread"></div>
					<div class="faint">cosmin.apreutesei@gmail.com | <a href="http://unlicense.org/">public domain</a></div>
				</footer>
			</div>
		</div>
	</body>
</html>

