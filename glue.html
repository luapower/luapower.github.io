<!DOCTYPE html>
<html>
	<head>
		<meta charset='utf-8'>
		<meta http-equiv="X-UA-Compatible" content="chrome=1">

		<link rel="stylesheet" type="text/css" href="templates/hack/stylesheet.css" media="screen" />

		<title> glue   - everyday Lua functions </title>

		<script src="templates/jquery-1.10.2.js"></script>

		<script language="javascript" type="text/javascript">
		  function resizeIframe(obj) {
			 obj.style.height = obj.contentWindow.document.body.scrollHeight + 'px';
		  }
		</script>
	</head>

	<body>

		<header>
			<div class="container">
				<table style="border: 0; margin: 0">
					<tr style="border: 0">
						<td valign="middle">
							<h1> glue </h1>
							<h2> everyday Lua functions </h2>
						</td>
						<td align="right">
								<table style="border: 0; margin: 0"><tr style="border: 0"><td>
								<a href="https://github.com/cosminap/glue" class="btn btn-github"><span class="icon"></span>View on GitHub</a>
								</td></tr><tr style="border: 0"><td>
								<a href="https://github.com/cosminap/glue/tarball/master" class="btn">Download as .tar.gz</a>
								</td></tr><tr style="border: 0"><td>
								<a href="https://github.com/cosminap/glue/zipball/master" class="btn">Download as .zip</a>
								</td></tr></table>
						</td>
					</tr>
				</table>
			</div>
		</header>

		<div class="tocparentdiv">
			<div class="tocdiv">
				<iframe src="toc.html" frameborder="0" scrolling="no" onload="javascript:resizeIframe(this)"></iframe>
			</div>
		</div>

		<div class="container">
			<section id="main_content">
			<p>v2.0 | <a href="glue_design.html">design</a> | LuaJIT 2, Lua 5.1, Lua 5.2</p>
<h2 id="local-glue-requireglue"><code>local glue = require'glue'</code></h2>
<table>
<tbody>
<tr class="odd">
<td align="left"><strong>tables</strong></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">glue.index(t) -&gt; dt</td>
<td align="left"><a href="#index">switch keys with values</a></td>
</tr>
<tr class="odd">
<td align="left">glue.keys(t[, sorted | cmp]) -&gt; dt</td>
<td align="left"><a href="#keys">make a list of all the keys</a></td>
</tr>
<tr class="even">
<td align="left">glue.update(dt,t1,...) -&gt; dt</td>
<td align="left"><a href="#update">merge tables - overwrites keys</a></td>
</tr>
<tr class="odd">
<td align="left">glue.merge(dt,t1,...) -&gt; dt</td>
<td align="left"><a href="#merge">merge tables - no overwriting</a></td>
</tr>
<tr class="even">
<td align="left">glue.sortedpairs(t[, cmp])-&gt; iterator<k,v></td>
<td align="left"><a href="#sortedpairs">like pairs() but in key order</a></td>
</tr>
<tr class="odd">
<td align="left"><strong>lists</strong></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">glue.extend(dt,t1,...) -&gt; dt</td>
<td align="left"><a href="#extend">extend a list</a></td>
</tr>
<tr class="odd">
<td align="left">glue.append(dt,v1,...) -&gt; dt</td>
<td align="left"><a href="#append">append values to a list</a></td>
</tr>
<tr class="even">
<td align="left">glue.shift(t,i,n) -&gt; t</td>
<td align="left"><a href="#shift">shift list elements</a></td>
</tr>
<tr class="odd">
<td align="left"><strong>strings</strong></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">glue.gsplit(s,sep[, plain]) -&gt; iterator<e[,captures...]></td>
<td align="left"><a href="#gsplit">split a string by a pattern</a></td>
</tr>
<tr class="odd">
<td align="left">glue.trim(s) -&gt; s</td>
<td align="left"><a href="#trim">remove padding</a></td>
</tr>
<tr class="even">
<td align="left">glue.escape(s[,mode])-&gt; s</td>
<td align="left"><a href="#escape">escape magic pattern characters</a></td>
</tr>
<tr class="odd">
<td align="left">glue.tohex(s) -&gt; s</td>
<td align="left"><a href="#tohex">string to hex</a></td>
</tr>
<tr class="even">
<td align="left">glue.fromhex(s) -&gt; s</td>
<td align="left"><a href="#fromhex">hex to string</a></td>
</tr>
<tr class="odd">
<td align="left"><strong>iterators</strong></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">glue.collect([i,]iterator)-&gt; t</td>
<td align="left"><a href="#collect">collect iterated values into a list</a></td>
</tr>
<tr class="odd">
<td align="left">glue.ipcall(iterator<v1,v2,...>) -&gt; iterator<ok,v1,v2,...></td>
<td align="left"><a href="#ipcall">iterator pcall</a></td>
</tr>
<tr class="even">
<td align="left"><strong>closures</strong></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">glue.pass(...) -&gt; ...</td>
<td align="left"><a href="#pass">does nothing, returns back all arguments</a></td>
</tr>
<tr class="even">
<td align="left"><strong>metatables</strong></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">glue.inherit(t,parent) -&gt; t</td>
<td align="left"><a href="#inherit">set or clear inheritance</a></td>
</tr>
<tr class="even">
<td align="left"><strong>i/o</strong></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">glue.fileexists(file) -&gt; true | false</td>
<td align="left"><a href="#fileexists">check if a file exists and it's readable</a></td>
</tr>
<tr class="even">
<td align="left">glue.readfile(file[format]) -&gt; s</td>
<td align="left"><a href="#readfile">read the contents of a file into a string</a></td>
</tr>
<tr class="odd">
<td align="left">glue.writefile(file,s[,format])</td>
<td align="left"><a href="#writefile">write a string to a file</a></td>
</tr>
<tr class="even">
<td align="left"><strong>errors</strong></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">glue.assert(v,[message[,args...]]) -&gt; args</td>
<td align="left"><a href="#assert">assert with error message formatting</a></td>
</tr>
<tr class="even">
<td align="left">glue.unprotect(ok,result,...) -&gt; result,... nil,result,...</td>
<td align="left"><a href="#unprotect">unprotect a protected call</a></td>
</tr>
<tr class="odd">
<td align="left">glue.pcall(f,...) -&gt; true,... | false,traceback</td>
<td align="left"><a href="#pcall">pcall with traceback</a> <em>(not for Lua 5.1)</em></td>
</tr>
<tr class="even">
<td align="left">glue.fpcall(f,...) -&gt; result | nil,traceback</td>
<td align="left"><a href="#fpcall">coding with finally and except</a></td>
</tr>
<tr class="odd">
<td align="left">glue.fcall(f,...) -&gt; result</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left"><strong>modules</strong></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">glue.autoload(t, submodule_t) -&gt; t</td>
<td align="left"><a href="#autoload">autoload table keys from submodules</a></td>
</tr>
</tbody>
</table>
<p><br /></p>
<h2 id="glue.indext---dt"><code id="index">glue.index(t) -&gt; dt</code></h2>
<p>Switch table keys with values.</p>
<h3 id="examples">Examples:</h3>
<p>Extract a rfc850 date from a string. Use lookup tables for weekdays and months.</p>
<pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">local</span> <span class="kw">weekdays</span> <span class="ot">=</span> <span class="kw">glue</span><span class="ot">.</span>index<span class="ot">{</span><span class="st">&#39;Sunday&#39;</span><span class="ot">,</span> <span class="st">&#39;Monday&#39;</span><span class="ot">,</span> <span class="st">&#39;Tuesday&#39;</span><span class="ot">,</span> <span class="st">&#39;Wednesday&#39;</span><span class="ot">,</span> <span class="st">&#39;Thursday&#39;</span><span class="ot">,</span> <span class="st">&#39;Friday&#39;</span><span class="ot">,</span> <span class="st">&#39;Saturday&#39;</span><span class="ot">}</span>
<span class="kw">local</span> <span class="kw">months</span> <span class="ot">=</span> <span class="kw">glue</span><span class="ot">.</span>index<span class="ot">{</span><span class="st">&#39;Jan&#39;</span><span class="ot">,</span> <span class="st">&#39;Feb&#39;</span><span class="ot">,</span> <span class="st">&#39;Mar&#39;</span><span class="ot">,</span> <span class="st">&#39;Apr&#39;</span><span class="ot">,</span> <span class="st">&#39;May&#39;</span><span class="ot">,</span> <span class="st">&#39;Jun&#39;</span><span class="ot">,</span> <span class="st">&#39;Jul&#39;</span><span class="ot">,</span> <span class="st">&#39;Aug&#39;</span><span class="ot">,</span> <span class="st">&#39;Sep&#39;</span><span class="ot">,</span> <span class="st">&#39;Oct&#39;</span><span class="ot">,</span> <span class="st">&#39;Nov&#39;</span><span class="ot">,</span> <span class="st">&#39;Dec&#39;</span><span class="ot">}</span>

<span class="co">--weekday &quot;,&quot; SP 2DIGIT &quot;-&quot; month &quot;-&quot; 2DIGIT SP 2DIGIT &quot;:&quot; 2DIGIT &quot;:&quot; 2DIGIT SP &quot;GMT&quot;</span>
<span class="co">--eg. Sunday, 06-Nov-94 08:49:37 GMT</span>
<span class="kw">function</span> rfc850date<span class="ot">(</span><span class="kw">s</span><span class="ot">)</span>
   <span class="kw">local</span> <span class="kw">w</span><span class="ot">,</span><span class="kw">d</span><span class="ot">,</span><span class="kw">mo</span><span class="ot">,</span><span class="kw">y</span><span class="ot">,</span><span class="kw">h</span><span class="ot">,</span><span class="kw">m</span><span class="ot">,</span><span class="kw">s</span> <span class="ot">=</span> <span class="kw">s</span>:match<span class="st">&#39;([A-Za-z]+), (%d+)%-([A-Za-z]+)%-(%d+) (%d+):(%d+):(%d+) GMT&#39;</span>
   <span class="kw">d</span><span class="ot">,</span><span class="kw">y</span><span class="ot">,</span><span class="kw">h</span><span class="ot">,</span><span class="kw">m</span><span class="ot">,</span><span class="kw">s</span> <span class="ot">=</span> <span class="fu">tonumber</span><span class="ot">(</span><span class="kw">d</span><span class="ot">),</span><span class="fu">tonumber</span><span class="ot">(</span><span class="kw">y</span><span class="ot">),</span><span class="fu">tonumber</span><span class="ot">(</span><span class="kw">h</span><span class="ot">),</span><span class="fu">tonumber</span><span class="ot">(</span><span class="kw">m</span><span class="ot">),</span><span class="fu">tonumber</span><span class="ot">(</span><span class="kw">s</span><span class="ot">)</span>
   <span class="kw">w</span> <span class="ot">=</span> <span class="fu">assert</span><span class="ot">(</span><span class="kw">weekdays</span><span class="ot">[</span><span class="kw">w</span><span class="ot">])</span>
   <span class="kw">mo</span> <span class="ot">=</span> <span class="fu">assert</span><span class="ot">(</span><span class="kw">months</span><span class="ot">[</span><span class="kw">mo</span><span class="ot">])</span>
   <span class="kw">if</span> <span class="kw">y</span> <span class="kw">then</span> <span class="kw">y</span> <span class="ot">=</span> <span class="kw">y</span> <span class="ot">+</span> <span class="ot">(</span><span class="kw">y</span> <span class="ot">&gt;</span> <span class="dv">50</span> <span class="kw">and</span> <span class="dv">1900</span> <span class="kw">or</span> <span class="dv">2000</span><span class="ot">)</span> <span class="kw">end</span>
   <span class="kw">return</span> <span class="ot">{</span><span class="kw">wday</span> <span class="ot">=</span> <span class="kw">w</span><span class="ot">,</span> <span class="kw">day</span> <span class="ot">=</span> <span class="kw">d</span><span class="ot">,</span> <span class="kw">year</span> <span class="ot">=</span> <span class="kw">y</span><span class="ot">,</span> <span class="kw">month</span> <span class="ot">=</span> <span class="kw">mo</span><span class="ot">,</span> <span class="kw">hour</span> <span class="ot">=</span> <span class="kw">h</span><span class="ot">,</span> <span class="fu">min</span> <span class="ot">=</span> <span class="kw">m</span><span class="ot">,</span> <span class="kw">sec</span> <span class="ot">=</span> <span class="kw">s</span><span class="ot">}</span>
<span class="kw">end</span>

<span class="kw">for</span> <span class="kw">k</span><span class="ot">,</span><span class="kw">v</span> <span class="kw">in</span> <span class="fu">pairs</span><span class="ot">(</span>rfc850date<span class="st">&#39;Sunday, 06-Nov-94 08:49:37 GMT&#39;</span><span class="ot">)</span> <span class="kw">do</span>
   <span class="fu">print</span><span class="ot">(</span><span class="kw">k</span><span class="ot">,</span><span class="kw">v</span><span class="ot">)</span>
<span class="kw">end</span></code></pre>
<p>Output:</p>
<pre><code>day 6
sec 37
wday    1
min 49
year    1994
month   11
hour    8</code></pre>
<p>Copy-paste a bunch of defines from a C header file and create an inverse lookup table to find the name of a value at runtime.</p>
<pre class="sourceCode lua"><code class="sourceCode lua"><span class="co">--from ibase.h</span>
<span class="kw">info_end_codes</span> <span class="ot">=</span> <span class="ot">{</span>
   <span class="kw">isc_info_end</span>             <span class="ot">=</span> <span class="dv">1</span><span class="ot">,</span>  <span class="co">--normal ending</span>
   <span class="kw">isc_info_truncated</span>       <span class="ot">=</span> <span class="dv">2</span><span class="ot">,</span>  <span class="co">--receiving buffer too small</span>
   <span class="kw">isc_info_error</span>           <span class="ot">=</span> <span class="dv">3</span><span class="ot">,</span>  <span class="co">--error, check status vector</span>
   <span class="kw">isc_info_data_not_ready</span>  <span class="ot">=</span> <span class="dv">4</span><span class="ot">,</span>  <span class="co">--data not available for some reason</span>
   <span class="kw">isc_info_svc_timeout</span>     <span class="ot">=</span> <span class="dv">64</span><span class="ot">,</span> <span class="co">--timeout expired</span>
<span class="ot">}</span>
<span class="kw">info_end_code_names</span> <span class="ot">=</span> <span class="kw">glue</span><span class="ot">.</span>index<span class="ot">(</span><span class="kw">info_end_codes</span><span class="ot">)</span>
<span class="fu">print</span><span class="ot">(</span><span class="kw">info_end_code_names</span><span class="ot">[</span><span class="dv">64</span><span class="ot">])</span></code></pre>
<p>Output:</p>
<pre><code>isc_info_svc_timeout</code></pre>
<hr />
<h2 id="glue.keyst-sorted-cmp---dt"><code id="keys">glue.keys(t[, sorted | cmp]) -&gt; dt</code></h2>
<p>Make a list of all the keys of <code>t</code>, optionally sorted.</p>
<h3 id="examples-1">Examples:</h3>
<p>An API expects a list of things but you have them as keys in a table because you are indexing something on them.</p>
<p>For instance, you have a table of the form <code>{socket = thread}</code> but <code>socket.select</code> wants a list of sockets.</p>
<p><em>See also:</em> <a href="#sortedpairs">glue.sortedpairs</a>.</p>
<hr />
<h2 id="glue.updatedtt1...---dt"><code id="update">glue.update(dt,t1,...) -&gt; dt</code></h2>
<p>Update a table with elements of other tables, overwriting any existing keys.</p>
<ul>
<li>nil arguments are skipped.</li>
</ul>
<h3 id="examples-2">Examples:</h3>
<p>Create an options table by merging the options received as an argument (if any) over the default options.</p>
<pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">function</span> f<span class="ot">(</span><span class="kw">opts</span><span class="ot">)</span>
   <span class="kw">opts</span> <span class="ot">=</span> <span class="kw">glue</span><span class="ot">.</span>update<span class="ot">({},</span> <span class="kw">default_opts</span><span class="ot">,</span> <span class="kw">opts</span><span class="ot">)</span>
<span class="kw">end</span></code></pre>
<p>Shallow table copy:</p>
<pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">t</span> <span class="ot">=</span> <span class="kw">glue</span><span class="ot">.</span>update<span class="ot">({},</span> <span class="kw">t</span><span class="ot">)</span></code></pre>
<p>Static multiple inheritance:</p>
<pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">C</span> <span class="ot">=</span> <span class="kw">glue</span><span class="ot">.</span>update<span class="ot">({},</span> <span class="kw">A</span><span class="ot">,</span> <span class="kw">B</span><span class="ot">)</span> <span class="co">--#TODO: find real-world example of multiple inheritance</span></code></pre>
<p><em>See also:</em> <a href="#extend">glue.extend</a>, <a href="#inherit">glue.inherit</a>.</p>
<hr />
<h2 id="glue.mergedtt1...---dt"><code id="merge">glue.merge(dt,t1,...) -&gt; dt</code></h2>
<p>Update a table with elements of other tables skipping on any existing keys.</p>
<ul>
<li>nil arguments are skipped.</li>
</ul>
<h3 id="examples-3">Examples:</h3>
<p>Normalize a data object with default values:</p>
<pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">glue</span><span class="ot">.</span>merge<span class="ot">(</span><span class="kw">t</span><span class="ot">,</span> <span class="kw">defaults</span><span class="ot">)</span></code></pre>
<p><em>See also:</em> <a href="#update">glue.update</a>.</p>
<hr />
<h2 id="glue.sortedpairstcmp---iteratorkv"><code id="sortedpairs">glue.sortedpairs(t[,cmp]) -&gt; iterator&lt;k,v&gt;</code></h2>
<p>Like pairs() but in key order.</p>
<p>The implementation creates a temporary table to sort the keys in.</p>
<table>
<col width="5%" />
<tbody>
<tr class="odd">
<td align="left"><em>See also:</em> <a href="#keys">glue.keys</a>.</td>
</tr>
</tbody>
</table>
<h2 id="glue.extenddtt1...---dt"><code id="extend">glue.extend(dt,t1,...) -&gt; dt</code></h2>
<p>Extend the list with the elements of other lists.</p>
<ul>
<li>nil arguments are skipped.</li>
<li>list elements are the ones from 1 to <code>#dt</code>.</li>
</ul>
<h3 id="uses">Uses:</h3>
<p>Accumulating values from multiple list sources.</p>
<p><em>See also:</em> <a href="#append">glue.append</a>, <a href="#update">glue.update</a>.</p>
<hr />
<h2 id="glue.appenddtv1...---dt"><code id="append">glue.append(dt,v1,...) -&gt; dt</code></h2>
<p>Append one or more values to a list.</p>
<h3 id="uses-1">Uses:</h3>
<p>Appending an object to a flattened list of lists (eg. appending a path element to a 2d path).</p>
<p><em>See also:</em> <a href="#extend">glue.extend</a>, <a href="#update">glue.update</a>.</p>
<hr />
<h2 id="glue.shifttin---t"><code id="shift">glue.shift(t,i,n) -&gt; t</code></h2>
<p>Shift all the list elements starting at index <code>i</code>, <code>n</code> positions to the left or further to the right.</p>
<p>For a positive <code>n</code>, shift the elements further to the right, effectively creating room for <code>n</code> new elements at index <code>i</code>. When <code>n</code> is 1, the effect is the same as for <code>table.insert(t, i, t[i])</code>. The old values at index <code>i</code> to <code>i+n-1</code> are preserved, so <code>#t</code> still works after the shifting.</p>
<p>For a negative <code>n</code>, shift the elements to the left, effectively removing the <code>n</code> elements at index <code>i</code>. When <code>n</code> is -1, the effect is the same as for <code>table.remove(t, i)</code>.</p>
<h3 id="uses-2">Uses:</h3>
<p>Removing a portion of a list or making room for more elements inside the list.</p>
<p><em>See also:</em> <a href="#extend">glue.extend</a>.</p>
<hr />
<h2 id="glue.gsplitssepplain---iteratorecaptures..."><code id="gsplit">glue.gsplit(s,sep[,plain]) -&gt; iterator&lt;e[,captures...]&gt;</code></h2>
<p>Split a string by a separator pattern (or plain string) and iterate over the elements.</p>
<ul>
<li>if sep is &quot;&quot; return the entire string in one iteration</li>
<li>if s is &quot;&quot; return s in one iteration</li>
<li>empty strings between separators are always returned, eg. <code>glue.gsplit(',', ',')</code> produces 2 empty strings</li>
<li>captures are allowed in sep and they are returned after the element, except for the last element for which they don't match (by definition).</li>
</ul>
<h3 id="examples-4">Examples:</h3>
<pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">for</span> <span class="kw">s</span> <span class="kw">in</span> <span class="kw">glue</span><span class="ot">.</span>gsplit<span class="ot">(</span><span class="st">&#39;Spam eggs spam spam and ham&#39;</span><span class="ot">,</span> <span class="st">&#39;%s*spam%s*&#39;</span><span class="ot">)</span> <span class="kw">do</span>
   <span class="fu">print</span><span class="ot">(</span><span class="st">&#39;&quot;&#39;</span><span class="ot">..</span><span class="kw">s</span><span class="ot">..</span><span class="st">&#39;&quot;&#39;</span><span class="ot">)</span>
<span class="kw">end</span>

<span class="ot">&gt;</span> <span class="st">&quot;Spam eggs&quot;</span>
<span class="ot">&gt;</span> <span class="st">&quot;&quot;</span>
<span class="ot">&gt;</span> <span class="st">&quot;and ham&quot;</span></code></pre>
<h3 id="design-notes">Design notes:</h3>
<ul>
<li>name choice: associate with <code>gmatch</code> and <code>gsub</code></li>
<li>allowing captures in <code>sep</code> doesn't have very readable semantics</li>
</ul>
<hr />
<h2 id="glue.trims---s"><code id="trim">glue.trim(s) -&gt; s</code></h2>
<p>Remove whitespace (defined as Lua pattern <code>%s</code>) from the beginning and end of a string.</p>
<hr />
<h2 id="glue.escapesmode---pat"><code id="escape">glue.escape(s[,mode]) -&gt; pat</code></h2>
<p>Escape magic characters of the string <code>s</code> so that it can be used as a pattern to string matching functions.</p>
<ul>
<li>the optional argument <code>mode</code> can have the value <code>&quot;*i&quot;</code> (for case insensitive), in which case each alphabetical character in <code>s</code> will also be escaped as <code>[aA]</code> so that it matches both its lowercase and uppercase variants.</li>
<li>escapes embedded zeroes as the <code>%z</code> pattern.</li>
</ul>
<h3 id="uses-3">Uses:</h3>
<ul>
<li>workaround for lack of pattern syntax for &quot;this part of a match is an arbitrary string&quot;</li>
<li>workaround for lack of a case-insensitive flag in pattern matching functions</li>
</ul>
<h3 id="design-notes-1">Design notes:</h3>
<p>Test the performance of the case-insensitive hack to see if it's feasible.</p>
<hr />
<h2 id="glue.tohexsupper---s"><code id="tohex">glue.tohex(s[,upper]) -&gt; s</code></h2>
<h2 id="glue.tohexnupper---s"><code>glue.tohex(n[,upper]) -&gt; s</code></h2>
<p>Convert a binary string or a Lua number to its hex representation.</p>
<ul>
<li>lowercase by default</li>
<li>uppercase if <code>upper</code> is anything non-false, like say, the string &quot;upper&quot;</li>
<li>numbers must be in the unsigned 32 bit integer range</li>
</ul>
<p><em>See also:</em> <a href="#fromhex">glue.fromhex</a>.</p>
<hr />
<h2 id="glue.fromhexs---s"><code id="fromhex">glue.fromhex(s) -&gt; s</code></h2>
<p>Convert a hex string to its binary representation.</p>
<p><em>See also:</em> <a href="#tohex">glue.tohex</a>.</p>
<hr />
<h2 id="glue.collecti-iterator---t"><code id="collect">glue.collect([i, ]iterator) -&gt; t</code></h2>
<p>Iterate an iterator and collect its i'th return value of every step into a list.</p>
<ul>
<li>i defaults to 1</li>
</ul>
<h3 id="examples-5">Examples:</h3>
<p>Implementation of <code>keys()</code> and <code>values()</code> in terms of <code>collect()</code></p>
<pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">keys</span> <span class="ot">=</span> <span class="kw">function</span><span class="ot">(</span><span class="kw">t</span><span class="ot">)</span> <span class="kw">return</span> <span class="kw">glue</span><span class="ot">.</span>collect<span class="ot">(</span><span class="fu">pairs</span><span class="ot">(</span><span class="kw">t</span><span class="ot">))</span> <span class="kw">end</span>
<span class="kw">values</span> <span class="ot">=</span> <span class="kw">function</span><span class="ot">(</span><span class="kw">t</span><span class="ot">)</span> <span class="kw">return</span> <span class="kw">glue</span><span class="ot">.</span>collect<span class="ot">(</span><span class="dv">2</span><span class="ot">,</span><span class="fu">pairs</span><span class="ot">(</span><span class="kw">t</span><span class="ot">))</span> <span class="kw">end</span></code></pre>
<p>Collecting string matches:</p>
<pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">s</span> <span class="ot">=</span> <span class="st">&#39;a,b,c,&#39;</span>
<span class="kw">t</span> <span class="ot">=</span> <span class="kw">glue</span><span class="ot">.</span>collect<span class="ot">(</span><span class="kw">s</span>:gmatch<span class="st">&#39;(.-),&#39;</span><span class="ot">)</span>
<span class="kw">for</span> <span class="kw">i</span><span class="ot">=</span><span class="dv">1</span><span class="ot">,#</span><span class="kw">t</span> <span class="kw">do</span> <span class="fu">print</span><span class="ot">(</span><span class="kw">t</span><span class="ot">[</span><span class="kw">i</span><span class="ot">])</span> <span class="kw">end</span>

<span class="ot">&gt;</span> <span class="kw">a</span>
<span class="ot">&gt;</span> <span class="kw">b</span>
<span class="ot">&gt;</span> <span class="kw">c</span></code></pre>
<h3 id="design-notes-2">Design notes:</h3>
<p>Alt. name: <code>ipack</code> - like pack but for iterators; collect is better at suggesting a process done in steps.</p>
<hr />
<h2 id="glue.ipcalliteratorv1...---iteratortruev1...falseerror"><code id="ipcall">glue.ipcall(iterator&lt;v1,...&gt;) -&gt; iterator&lt;true,v1,...|false,error&gt;</code></h2>
<p>Wraps an iterator such that each iteration is wrapped in a pcall.</p>
<h3 id="uses-4">Uses:</h3>
<p>Iterators that can break with an error (eg. database fetch iterators).</p>
<hr />
<h2 id="glue.pass...---..."><code id="pass">glue.pass(...) -&gt; ...</code></h2>
<p>The identity function. Does nothing, returns back all arguments.</p>
<h3 id="uses-5">Uses:</h3>
<p>Default value for optional callback arguments:</p>
<pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">function</span> urlopen<span class="ot">(</span><span class="kw">url</span><span class="ot">,</span> <span class="kw">callback</span><span class="ot">,</span> <span class="kw">errback</span><span class="ot">)</span>
   <span class="kw">callback</span> <span class="ot">=</span> <span class="kw">callback</span> <span class="kw">or</span> <span class="kw">glue</span><span class="ot">.</span><span class="kw">pass</span>
   <span class="kw">errback</span> <span class="ot">=</span> <span class="kw">errback</span> <span class="kw">or</span> <span class="kw">glue</span><span class="ot">.</span><span class="kw">pass</span>
   <span class="ot">...</span>
   callback<span class="ot">()</span>
<span class="kw">end</span></code></pre>
<hr />
<h2 id="glue.inheritt-parent---t"><code id="inherit">glue.inherit(t, parent) -&gt; t</code></h2>
<h2 id="glue.inheritt-nil---t"><code>glue.inherit(t, nil) -&gt; t</code></h2>
<p>Set a table to inherit attributes from a parent table, or clear inheritance.</p>
<p>If the table has no metatable (and inheritance has to be set, not cleared) make it one.</p>
<h3 id="examples-6">Examples:</h3>
<p>Logging mixin:</p>
<pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">AbstractLogger</span> <span class="ot">=</span> <span class="kw">glue</span><span class="ot">.</span>inherit<span class="ot">({},</span> <span class="kw">function</span><span class="ot">(</span><span class="kw">t</span><span class="ot">,</span><span class="kw">k</span><span class="ot">)</span> <span class="fu">error</span><span class="ot">(</span><span class="st">&#39;abstract &#39;</span><span class="ot">..</span><span class="kw">k</span><span class="ot">)</span> <span class="kw">end</span><span class="ot">)</span>
<span class="kw">NullLogger</span> <span class="ot">=</span> <span class="kw">glue</span><span class="ot">.</span>inherit<span class="ot">({</span><span class="fu">log</span> <span class="ot">=</span> <span class="kw">function</span><span class="ot">()</span> <span class="kw">end</span><span class="ot">},</span> <span class="kw">AbstractLogger</span><span class="ot">)</span>
<span class="kw">PrintLogger</span> <span class="ot">=</span> <span class="kw">glue</span><span class="ot">.</span>inherit<span class="ot">({</span><span class="fu">log</span> <span class="ot">=</span> <span class="kw">function</span><span class="ot">(</span><span class="kw">self</span><span class="ot">,...)</span> <span class="fu">print</span><span class="ot">(...)</span> <span class="kw">end</span><span class="ot">},</span> <span class="kw">AbstractLogger</span><span class="ot">)</span>

<span class="kw">HttpRequest</span> <span class="ot">=</span> <span class="kw">glue</span><span class="ot">.</span>inherit<span class="ot">({</span>
   <span class="kw">perform</span> <span class="ot">=</span> <span class="kw">function</span><span class="ot">(</span><span class="kw">self</span><span class="ot">,</span> <span class="kw">url</span><span class="ot">)</span>
      <span class="kw">self</span>:<span class="fu">log</span><span class="ot">(</span><span class="st">&#39;Requesting&#39;</span><span class="ot">,</span> <span class="kw">url</span><span class="ot">,</span> <span class="st">&#39;...&#39;</span><span class="ot">)</span>
      <span class="ot">...</span>
   <span class="kw">end</span>
<span class="ot">},</span> <span class="kw">NullLogger</span><span class="ot">)</span>

<span class="kw">LoggedRequest</span> <span class="ot">=</span> <span class="kw">glue</span><span class="ot">.</span>inherit<span class="ot">({</span><span class="fu">log</span> <span class="ot">=</span> <span class="kw">PrintLogger</span><span class="ot">.</span><span class="kw">log</span><span class="ot">},</span> <span class="kw">HttpRequest</span><span class="ot">)</span>

<span class="kw">LoggedRequest</span>:perform<span class="st">&#39;http://lua.org/&#39;</span>

<span class="ot">&gt;</span> <span class="kw">Requesting</span>    <span class="kw">http</span>:<span class="ot">//</span><span class="kw">lua</span><span class="ot">.</span><span class="kw">org</span><span class="ot">/</span> <span class="ot">...</span></code></pre>
<p>Defining a module in Lua 5.2</p>
<pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">_ENV</span> <span class="ot">=</span> <span class="kw">glue</span><span class="ot">.</span>inherit<span class="ot">({},</span><span class="kw">_G</span><span class="ot">)</span>
<span class="ot">...</span></code></pre>
<p>Hints:</p>
<ul>
<li>to get the effect of static (single or multiple) inheritance, use <a href="#update">glue.update</a>.</li>
<li>when setting inheritance, you can pass in a function.</li>
</ul>
<h3 id="design-notes-3">Design notes:</h3>
<p><code>t = setmetatable({},{__index=parent})</code> is not much longer and it's idiomatic, but doesn't shout inheritance at you (you have to process the indirection, like with functional idioms) and you can't use it to change the parent (a minor quibble nevertheless).</p>
<p>Overriding of methods needs an easy way to access the &quot;parent&quot; or to invoke a method on the parent. A top-level class could provide this simply by defining <code>function Object:parent() return getmetatable(self).__index end</code>.</p>
<hr />
<h2 id="glue.fileexistsfile---true-false"><code id="fileexists">glue.fileexists(file) -&gt; true | false</code></h2>
<p>Checks whether a file exists and it's available for reading.</p>
<p><em>See also:</em> <a href="#readfile">glue.readfile</a>.</p>
<hr />
<h2 id="glue.readfilefileformat---s"><code id="readfile">glue.readfile(file[,format]) -&gt; s</code></h2>
<p>Read the contents of a file into a string.</p>
<ul>
<li><code>format</code> can be <code>t</code> in which case the file will be read in text mode (default is binary mode).</li>
</ul>
<p><em>See also:</em> <a href="#writefile">glue.writefile</a>, <a href="#fileexists">glue.fileexists</a>.</p>
<hr />
<h2 id="glue.writefilefilesformat"><code id="writefile">glue.writefile(file,s[,format])</code></h2>
<p>Write the contents of a string to a file.</p>
<ul>
<li><code>format</code> can be <code>t</code> in which case the file will be written in text mode (default is binary mode).</li>
</ul>
<p><em>See also:</em> <a href="#readfile">glue.readfile</a>.</p>
<hr />
<h2 id="glue.assertv-message-format_args..."><code id="assert">glue.assert(v[, message[, format_args...]])</code></h2>
<p>Like <code>assert</code> but supports formatting of the error message using string.format.</p>
<p>This is better than <code>assert(string.format(message, format_args...))</code> because it avoids creating the message string when the assertion is true.</p>
<h3 id="example">Example:</h3>
<pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">glue</span><span class="ot">.</span>assert<span class="ot">(</span><span class="kw">depth</span> <span class="ot">&lt;=</span> <span class="kw">maxdepth</span><span class="ot">,</span> <span class="st">&#39;maximum depth %d exceeded&#39;</span><span class="ot">,</span> <span class="kw">maxdepth</span><span class="ot">)</span></code></pre>
<hr />
<h2 id="glue.unprotectokresult...---result...-nilresult..."><code id="unprotect">glue.unprotect(ok,result,...) -&gt; result,... | nil,result,...</code></h2>
<p>In Lua, API functions conventionally signal errors by returning nil and an error message instead of raising exceptions. In the implementation however, using assert() and error() is preferred to coding explicit conditional flows to cover exceptional cases. Use this function to convert error-raising functions to nice nil,error-returning functions:</p>
<pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">function</span> my_API_function<span class="ot">()</span>
  <span class="kw">return</span> <span class="kw">glue</span><span class="ot">.</span>unprotect<span class="ot">(</span><span class="fu">pcall</span><span class="ot">(</span><span class="kw">function</span><span class="ot">()</span>
    <span class="ot">...</span>
    <span class="fu">assert</span><span class="ot">(...)</span>
    <span class="ot">...</span>
    <span class="fu">error</span><span class="ot">(...)</span>
    <span class="ot">...</span>
    <span class="kw">return</span> <span class="kw">result_value</span>
  <span class="kw">end</span><span class="ot">))</span>
<span class="kw">end</span></code></pre>
<hr />
<p><strong>Note: Lua 5.2 and LuaJIT 2 only.</strong></p>
<h2 id="glue.pcallf...---true...-falseerror..n..traceback"><code id="pcall">glue.pcall(f,...) -&gt; true,... | false,error..'\n'..traceback</code></h2>
<p>With Lua's pcall() you lose the stack trace, and with usual uses of pcall() you don't want that, thus this variant that appends the traceback to the error message.</p>
<hr />
<h2 id="glue.fpcallf...---result-nilerror..n..traceback"><code id="fpcall">glue.fpcall(f,...) -&gt; result | nil,error..'\n'..traceback</code></h2>
<h2 id="glue.fcallf...---result"><code>glue.fcall(f,...) -&gt; result</code></h2>
<p>These constructs bring the ubiquitous try/finally/except idiom to Lua. The first variant returns nil,error when errors occur while the second re-raises the error.</p>
<h3 id="pseudo-example">Pseudo-example:</h3>
<pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">local</span> <span class="kw">result</span> <span class="ot">=</span> <span class="kw">glue</span><span class="ot">.</span>fpcall<span class="ot">(</span><span class="kw">function</span><span class="ot">(</span><span class="kw">finally</span><span class="ot">,</span> <span class="kw">except</span><span class="ot">,</span> <span class="ot">...)</span>
  <span class="kw">local</span> <span class="kw">temporary_resource</span> <span class="ot">=</span> acquire_resource<span class="ot">()</span>
  finally<span class="ot">(</span><span class="kw">function</span><span class="ot">()</span> <span class="kw">temporary_resource</span>:free<span class="ot">()</span> <span class="kw">end</span><span class="ot">)</span>
  <span class="ot">...</span>
  <span class="kw">local</span> <span class="kw">final_resource</span> <span class="ot">=</span> acquire_resource<span class="ot">()</span>
  except<span class="ot">(</span><span class="kw">function</span><span class="ot">()</span> <span class="kw">final_resource</span>:free<span class="ot">()</span> <span class="kw">end</span><span class="ot">)</span>
  <span class="ot">...</span> <span class="kw">code</span> <span class="kw">that</span> <span class="kw">might</span> <span class="kw">break</span> <span class="ot">...</span>
  <span class="kw">return</span> <span class="kw">final_resource</span>
<span class="kw">end</span><span class="ot">,</span> <span class="ot">...)</span></code></pre>
<hr />
<h2 id="glue.autoloadt-submodules---t"><code id="autoload">glue.autoload(t, submodules) -&gt; t</code></h2>
<p>Assign a metatable to <code>t</code> such that when a missing key is accessed, the module said to contain that key is require'd automatically.</p>
<p>The <code>submodules</code> argument is a table of form <code>{key = module_name | load_function}</code> specifying the corresponding Lua module (or load function) that make each key available to <code>t</code>.</p>
<h3 id="motivation">Motivation:</h3>
<p>Module autoloading allows you to split the implementation of a module in many submodules containing optional, self-contained functionality, without having to make this visible in the user API. This effectively separates how you split your APIs from how you split the implementation, allowing you to change the way the implementation is split at a later time while keeping the API intact.</p>
<h3 id="example-1">Example:</h3>
<p><strong>main module (foo.lua):</strong></p>
<pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">local</span> <span class="kw">function</span> bar<span class="ot">()</span> <span class="co">--function implemented in the main module</span>
  <span class="ot">...</span>
<span class="kw">end</span>

<span class="co">--create and return the module table</span>
<span class="kw">return</span> <span class="kw">glue</span><span class="ot">.</span>autoload<span class="ot">({</span>
   <span class="ot">...</span>
   <span class="kw">bar</span> <span class="ot">=</span> <span class="kw">bar</span><span class="ot">,</span>
<span class="ot">},</span> <span class="ot">{</span>
   <span class="kw">baz</span> <span class="ot">=</span> <span class="st">&#39;foo_extra&#39;</span><span class="ot">,</span> <span class="co">--autoloaded function, implemented in module foo_extra</span>
<span class="ot">})</span></code></pre>
<p><strong>submodule (foo_extra.lua):</strong></p>
<pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">local</span> <span class="kw">foo</span> <span class="ot">=</span> require<span class="st">&#39;foo&#39;</span>

<span class="kw">function</span> <span class="kw">foo</span><span class="ot">.</span>baz<span class="ot">(...)</span>
  <span class="ot">...</span>
<span class="kw">end</span></code></pre>
<p><strong>in usage:</strong></p>
<pre class="sourceCode lua"><code class="sourceCode lua"><span class="kw">local</span> <span class="kw">foo</span> <span class="ot">=</span> require<span class="st">&#39;foo&#39;</span>

<span class="kw">foo</span><span class="ot">.</span>baz<span class="ot">(...)</span> <span class="co">-- foo_extra was now loaded automatically</span></code></pre>
<hr />
<h3 id="tips">Tips</h3>
<p>String functions are also in the <code>glue.string</code> table. You can extend the Lua <code>string</code> namespace:</p>
<pre><code>glue.update(string, glue.string)</code></pre>
<p>so you can use them as string methods:</p>
<pre><code>s = s:trim()</code></pre>
<h3 id="keywords">Keywords</h3>
<p><em>for syntax highlighting</em></p>
<p>glue.index, glue.keys, glue.update, glue.merge, glue.extend, glue.append, glue.shift, glue.gsplit, glue.trim, glue.escape, glue.collect, glue.ipcall, glue.pass, glue.inherit, glue.fileexists, glue.readfile, glue.writefile, glue.assert, glue.unprotect, glue.pcall, glue.fpcall, glue.fcall, glue.autoload</p>
			</section>
		</div>

	</body>
</html>
