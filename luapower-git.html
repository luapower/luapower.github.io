<!DOCTYPE html>
<html>
	<head>
		<meta charset='utf-8'>
		<title> luapower-git   - git workflow for luapower </title>
		<script src="jquery.js"></script>
		<script src="jquery-cookie.js"></script>
		<script src="jquery-tablesorter.js"></script>
		<script src="strftime.js"></script>
		<script src="config.js"></script>
		<script src="main.js"></script>
		<link rel="stylesheet" type="text/css" href="templates/reset.css" />
		<link rel="stylesheet" type="text/css" href="templates/hack.css" />
		<link rel="stylesheet" type="text/css" id="lights_css" />
		<script>
			var DOCNAME = 'luapower-git'
			var PROJECT = 'luapower-git'
			//set the lights before rendering starts
			set_lights()
		</script>
	</head>
	<body>
		<header>
			<div class="container">
				<div class="btn-container btn-lights-container">
					<a href="#" class="btn btn-lights" id="lights">lights</a>
				</div>
				
				<div class="btn-container btn-home-container">
					<a href="/" class="btn btn-home">luapower</a>
				</div>
				
				<table id="header_table">
					<tr>
						<td style="vertical-align: middle;" width="100%">
							<h1> luapower-git </h1>
							<h2> git workflow for luapower </h2>
						</td>
						<td style="vertical-align: middle;" align="right" style="height: 150px">
																						<table><tr><td>
								<div class="doc" id="package_info_container">
									<div id="package_info">&nbsp;</div>
									<div id="commit_log">&nbsp;</div>
								</div>
								<a href="https://github.com/luapower/luapower-git" class="btn btn-rightside btn-github"><span class="icon"></span>View on GitHub</a>
								</td></tr><tr><td>
								<a href="https://github.com/luapower/luapower-git/tarball/master" class="btn btn-rightside">Download as .tar.gz</a>
								</td></tr><tr><td>
								<a href="https://github.com/luapower/luapower-git/zipball/master" class="btn btn-rightside">Download as .zip</a>
								</td></tr></table>
																				</td>
					</tr>
				</table>
												<div class="btn-container btn-discuss-container">
					<a href="https://github.com/luapower/luapower-git/issues/new" target="_blank" class="btn btn-rightside btn-discuss"><span class="icon"></span>Discuss</a>
				</div>
											</div>
		</header>
		<div class="container">
			<div id="toc_container" class="toc_container doc"></div>
			<section class="doc">
				<span id="module_info"></span>
				<h2 id="what">What</h2>
<p>Downloading and managing luapower packages the git way.</p>
<h2 id="why-not-just-use-git-directly">Why not just use git directly?</h2>
<p>Mainly because luapower packages need to be overlaid over the same directory, but you can't just git-clone multiple repos over the same directory with git (for no reason- git-clone could and should totally allow you to do that). Git <em>does</em> support overlaying multiple repos over a common directory structure but that's <a href="http://github.com/luapower/luapower-git/blob/master/clone.cmd">not trivial</a> to set up, and that is where <a href="luapower-git.html">luapower-git</a> comes in.</p>
<h2 id="how">How</h2>
<p>First, let's git it:</p>
<pre><code>&gt; git clone https://github.com/luapower/luapower-git luapower
&gt; cd luapower</code></pre>
<blockquote>
<p>The SSH url is <code>ssh://git@github.com/luapower/luapower-git</code></p>
</blockquote>
<p>This brings in the <code>clone</code> and <code>remove</code> commands:</p>
<pre><code>&gt; clone

USAGE:
   clone &lt;package&gt; [origin | url]    clone a package
   clone --list                      list uncloned packages
   clone --all                       clone all packages</code></pre>
<blockquote>
<p><strong>NOTE:</strong> In Linux, the command is <code>./clone.sh</code>. They're all like that.</p>
</blockquote>
<blockquote>
<p><strong>NOTE:</strong> To clone packages via SSH instead, edit <code>_git/luapower.baseurl</code> and replace the url there with <code>ssh://git@github.com/luapower/</code></p>
</blockquote>
<blockquote>
<p><strong>Tip:</strong> You can clone repos from any location, as long as they have the proper <a href="get-involved.html">directory layout</a>.</p>
</blockquote>
<blockquote>
<p><strong>Tip:</strong> Remote origins can be labeled to avoid typing the full url every time when cloning. Create a file named <code>_git/foo.baseurl</code>, write the base url (with traling slash) in it, and then clone with <code>clone &lt;package&gt; foo</code>.</p>
</blockquote>
<pre><code>&gt; remove

USAGE:
   remove &lt;package&gt;       remove a cloned package completely from the disk
   remove --list          list cloned packages</code></pre>
<p>The rest is done via git, using the <code>proj</code> command to set the context (repo) in which git should operate.</p>
<pre><code>&gt; proj foo
[foo] &gt; git ls-files

foo.lua
foo.md

[foo] &gt; proj bar
[bar] &gt; git pull
...
[bar] &gt; proj baz
[baz] &gt; git pull
...</code></pre>
<blockquote>
<p><code>proj</code> is but a glorified wrapper for setting the env var <code>GIT_DIR=_git/&lt;package&gt;/.git</code>, which allows us to use git as normal without leaving the work-tree.</p>
</blockquote>
<h2 id="the-luapower-command">The <code>luapower</code> command</h2>
<p>This is a powerful command that extracts and aggregates data from the luapower environment and gives detailed information about packages, modules and documentation. It can give accurate information about dependencies between modules and packages because it actually loads the module and tracks <code>require</code> calls, and then it integrates that information with the information about packages.</p>
<p>It is also used for generating the package database on luapower.com, along with the the dependency lists you see on each module's page.</p>
<p>The <code>luapower</code> command is a Lua script that depends on <a href="luajit.html">luajit</a>, <a href="lfs.html">lfs</a>, <a href="glue.html">glue</a> and <a href="tuple.html">tuple</a> so let's clone these first:</p>
<pre><code>&gt; clone luajit
&gt; clone lfs
&gt; clone glue
&gt; clone tuple</code></pre>
<p>The rest you can learn from the tool itself:</p>
<pre><code>&gt; luapower

USAGE: luapower &lt;command&gt; ...

HELP

   help                           this screen

PACKAGES

   packages                       list installed packages
   known                          list all known package
   left                           list not yet installed packages

PACKAGE INFO

   describe &lt;package&gt;             describe a package
   type [package]                 package type
   ver [package]                  current git version
   tags [package]                 git tags
   tag [package]                  current git tag
   files [package]                tracked files
   docs [package]                 docs
   modules [package]              modules
   scripts [package]              scripts
   mtree [package]                module tree
   mtags [package [module]]       module info
   platforms [package]            supported platforms
   ctags [package]                C package info

CHECKS

   check [package]                consistency checks
   trackable                      trackable files
   multitracked                   files tracked by multiple packages
   untracked                      files not tracked by any package

DATABASE

   update-db [package]            update _site/packages.json
   update-toc [package]           update _site/toc.md
   update [package]               update both _site/packages.json and _site/toc.md

DEPENDENCIES

   requires &lt;module&gt;              direct module requires
   rall &lt;module&gt;                  direct and indirect module requires
   rtree &lt;module&gt;                 module require log tree
   rext &lt;module&gt;                  direct-external module requires
   pall &lt;module&gt;                  direct and indirect package dependencies
   pext &lt;module&gt;                  direct-external package dependencies
   ppall [package]                direct and indirect package dependencies
   ppext [package]                direct-external package dependencies
   cdeps [package]                direct and indirect C dependencies
   rrev &lt;module&gt;                  all modules that require a module

The `package` arg defaults to the env var PROJECT, as set by the `proj` command,
and if that is not set, it defaults to `--all`, meaning all packages.</code></pre>
<h2 id="building-all-c-libraries">Building all C libraries</h2>
<pre><code>&gt; cd csrc
&gt; build --all</code></pre>
<p>This builds all packages that have a build script in the right order (pretty fast too).</p>
<h2 id="module-development">Module development</h2>
<p>Some handy git wrappers for tracking changes across the entire repo collection:</p>
<table>
<tbody>
<tr class="odd">
<td align="left"><code>&gt; modified</code></td>
<td align="left">list modified files across all repos</td>
</tr>
<tr class="even">
<td align="left"><code>&gt; unpushed</code></td>
<td align="left">list unpushed repos</td>
</tr>
<tr class="odd">
<td align="left"><code>&gt; untracked</code></td>
<td align="left">list untracked files (takes a while)</td>
</tr>
</tbody>
</table>
			</section>
		</div>
		<div class="container">
			<footer>
				<div id="disqus_thread"></div>
				<div class="faint">cosmin.apreutesei@gmail.com | <a href="http://unlicense.org/">public domain</a></div>
			</footer>
		</div>
	</body>
</html>

